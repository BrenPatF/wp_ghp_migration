SQL> SELECT 'Start: ' || To_Char(SYSDATE,'DD-MON-YYYY HH24:MI:SS') FROM DUAL;

'START:'||TO_CHAR(SYSDATE,'DD-MON-YY
------------------------------------
Start: 13-JUL-2013 14:23:42

SQL> BEGIN
  2    Utils.Clear_Log;
  3  END;
  4  /

PL/SQL procedure successfully completed.

SQL> BREAK ON tot_dist
SQL> PROMPT Ordered solution
Ordered solution
SQL> WITH legs AS (
  2  SELECT twn.id town_id,
  3         Lag (twn.id) OVER (ORDER BY twn.id) town_id_prior
  4    FROM towns twn
  5  )
  6  SELECT Round (Sum (d.dst) OVER ()) tot_dist,
  7         t.id,
  8         t.name,
  9         Round (d.dst) leg_dist
 10    FROM towns t
 11    JOIN legs l
 12      ON l.town_id = t.id
 13    LEFT JOIN distances d
 14      ON d.a = l.town_id_prior
 15     AND d.b = l.town_id
 16  ORDER BY t.id
 17  /

  TOT_DIST         ID NAME                             LEG_DIST
---------- ---------- ------------------------------ ----------
         7          1 Origin
                    2 Left Peak                               2
                    3 Midfield                                1
                    4 Right Peak                              1
                    5 Destination                             2

SQL> SET TIMING ON
SQL> @..\sql\Town_SQL 1 2 2
old   2:   :ROOT := &1;
new   2:   :ROOT := 1;
old   3:   :KEEP_NUM_ROOT := &2;
new   3:   :KEEP_NUM_ROOT := 2;
old   4:   :KEEP_NUM := &3;
new   4:   :KEEP_NUM := 2;

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.00
Running for root, keep root, keep values of...

      ROOT
----------
         1


KEEP_NUM_ROOT
-------------
            2


  KEEP_NUM
----------
         2

Top n solutions

FIRST_TOWN   PATH_RNK   TOT_DIST    TOWN_ID NAME                             LEG_DIST   CUM_DIST
---------- ---------- ---------- ---------- ------------------------------ ---------- ----------
         2          1        7.3          1 Origin
                                          2 Left Peak                            2.24       2.24
                                          3 Midfield                             1.41       3.65
                                          4 Right Peak                           1.41       5.06
                                          5 Destination                          2.24        7.3
                    2       7.89          1 Origin
                                          2 Left Peak                            2.24       2.24
                                          4 Right Peak                              2       4.24
                                          3 Midfield                             1.41       5.65
                                          5 Destination                          2.24       7.89
         3          1       7.89          1 Origin
                                          3 Midfield                             2.24       2.24
                                          2 Left Peak                            1.41       3.65
                                          4 Right Peak                              2       5.65
                                          5 Destination                          2.24       7.89
                    2       9.26          1 Origin
                                          3 Midfield                             2.24       2.24
                                          4 Right Peak                           1.41       3.65
                                          2 Left Peak                               2       5.65
                                          5 Destination                          3.61       9.26

20 rows selected.

Elapsed: 00:00:00.03
SQL> 
SQL> @..\..\Brendan\sql\L_Log_Default

no rows selected

Elapsed: 00:00:00.02
SQL> COMMIT
  2  /

Commit complete.

Elapsed: 00:00:00.00
SQL> SELECT 'End: ' || To_Char(SYSDATE,'DD-MON-YYYY HH24:MI:SS') FROM DUAL;

'END:'||TO_CHAR(SYSDATE,'DD-MON-YY
----------------------------------
End: 13-JUL-2013 14:23:42

Elapsed: 00:00:00.00
SQL> SPOOL OFF
